var ProductList=ProductList||{};ProductList.Store=function(){"use strict";function a(a){this.data=a}function b(b){a.call(this,b)}function c(b){b.limit=0,a.call(this,b)}function d(a){this.code=a,this.validated=!1,this.used=!1}function e(a,b){d.call(this,a),this.discountPercent=b}function f(a,b){d.call(this,a),this.itemId=b}function g(a,d){var e=ProductList.Utils.copyObject(a.getAllData()),f=d.getDiscountPercent();return a instanceof c||0===a.getPrice()?a:(e.discountPercent=e.discountPercent||0,e.discountPercent+=f,e.discountPercent>100&&(e.discountPercent=100),new b(e))}function h(){k=k.map(function(d){var e=ProductList.Utils.getRandom(10),f=null;return 7>e?f=new a(d):9>e?(d.discountPercent=ProductList.Utils.getRandom(50),f=new b(d)):f=new c(d),f})}function i(){return k}function j(){return l}var k=ProductList.Mock;a.prototype={getId:function(){return this.data.id},setId:function(a){return this.data.id=a,a},getName:function(){return this.data.name},getPrice:function(){return parseInt(this.data.price,10)},getStock:function(){return this.data.limit},setStock:function(a){return this.data.limit=a,a},isInStock:function(){return this.data.limit>0},getAllData:function(){return this.data},constructor:a},b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.getDiscountPercent=function(){return this.data.discountPercent},b.prototype.getPrice=function(){var a=parseInt(this.data.price,10),b=a-this.getDiscountPercent()/100*a;return parseInt(b,10)},c.prototype=Object.create(a.prototype),c.prototype.constructor=c,d.prototype={validate:function(a){return this.validated=this.code===a,this},constructor:d},e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.getDiscountPercent=function(){return this.discountPercent},e.prototype.apply=function(){if(this.validated&&!this.used){var a=this;return k=k.map(function(b){return g(b,a)}),ProductList.PubSub.publish("couponApplied",[]),this.used=!0,!0}return!1},f.prototype=Object.create(d.prototype),f.prototype.constructor=f,f.prototype.getDiscountPercent=function(){return 100},f.prototype.getItemId=function(){return this.itemId},f.prototype.apply=function(){if(this.validated&&!this.used){var a=ProductList.Utils.getItemById(k,this.getItemId()),b=a.getStock(),c=g(a,this);return a.isInStock()?(a.setStock(b-1),c.setId(c.getId()+"F"),c.setStock(1),k.unshift(c),ProductList.PubSub.publish("couponApplied",[]),this.used=!0,!0):(alert("Sorry, item out of stock."),!0)}return!1};var l=[new e("123",20),new f("qwe","55927eac85594c45b02c5963")];return h(),{Item:a,ItemOnSale:b,ItemOutOfStock:c,Coupon:d,CouponDiscount:e,getProducts:i,getCoupons:j}}();