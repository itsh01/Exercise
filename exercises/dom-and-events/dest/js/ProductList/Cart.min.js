define(["Store","Utils","PubSub","lodash"],function(a,b,c,d){"use strict";function e(a){n[a]=n[a]||0,n[a]+=1}function f(a){n[a]=n[a]||0,n[a]>0&&(n[a]-=1)}function g(a,b){b>0?e(a):f(a),c.publish("itemUpdated",[a])}function h(){var c=null;return o=a.getProducts(),d.reduce(n,function(a,d,e){return c=b.getItemById(o,e),a+parseInt(c.getPrice(),10)*d},0)}function i(){var a=document.getElementById("cart-input");a.value=h()}function j(a){return n[a]}function k(){return n}function l(){var a=null;d.forIn(n,function(c,d){a=b.getItemById(o,d),a.setStock(a.getStock()-c)}),n={},c.publish("orderCommitted",[])}function m(){c.subscribe("itemUpdated",i),c.subscribe("couponApplied",i),c.subscribe("orderCommitted",i)}var n={},o=a.getProducts();return m(),{updateCart:i,updateItem:g,getItemCount:j,commitOrder:l,getItemsSummary:k,getTotalPrice:h}});