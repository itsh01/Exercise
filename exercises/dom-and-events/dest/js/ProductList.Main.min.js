var ProductList=ProductList||{};ProductList.Main=function(){"use strict";function a(){return _.pluck(K,"dataset.header")}function b(){s(),t(),u(),v()}function c(a){var b=0,c=a.length>P?P:a.length,d=document.createDocumentFragment();for(b;c>b;b++)d.appendChild(e(a[b],c));return d}function d(a,d){var e=null;e=c(d),a.appendChild(e),b()}function e(a,b){var c=document.createElement("div"),d=null,e=a instanceof ProductList.Store.ItemOnSale,h=!a.isInStock();return c.className+=" table-row",e&&(c.className+=" item-on-sale"),h&&(c.className+=" item-out-of-stock"),_.forIn(N,function(b){d=document.createElement("div"),d.innerHTML=a.data[b],e&&"price"===b&&(d.innerHTML='<div class="discounted">'+a.data[b]+"<div>",d.innerHTML+='<div class="real-price">'+a.getPrice()+"&dollar;<div>"),d.className="table-cell item-"+b,c.appendChild(d)}),c.appendChild(f(a.getId())),g(c,b),c}function f(a){var b=document.createElement("div");return b.className="table-cell",b.innerHTML='<input type="number" disabled="disabled" data-itemid="'+a+'" />',b.innerHTML+='<button class="btn btn-primary btn-xs change-amount" data-action="-1">-</button>',b.innerHTML+='<button class="btn btn-primary btn-xs change-amount" data-action="1">+</button>',b}function g(a,b){var c=a.querySelector(".item-id"),d=document.createElement("div"),e=document.createElement("select");e.innerHTML=h(1,b+1),e.addEventListener("change",function(){r(this)}),d.className="table-cell select-order",d.appendChild(e),a.insertBefore(d,c)}function h(a,b){var c="";return _.forIn(_.range(a,b),function(a){c+='<option value="'+a+'">'+a+"</option>"}),c}function i(a){function b(){this.dispatchEvent(O)}var c=0,d=ProductList.Utils.convertToArray(a.querySelectorAll("[data-pagenum]"));_(d).forEach(function(a){c=a.dataset.pagenum,a.addEventListener("moveToPageEvent",p.bind(null,c)),a.addEventListener("click",b)}).value()}function j(){var a=document.getElementById("items-per-page");a.addEventListener("change",n),a.value=P}function k(a){document.getElementsByClassName("container")[0].appendChild(a)}function l(a){var b=document.createElement("nav"),c=document.querySelector(".pagination-container"),d='<ul class="pagination">',e=Math.ceil(a.length/P);_.forIn(_.range(1,e+1),function(a){d+='<li><a href="#" data-pagenum="'+a+'">'+a+"</a></li>"}),d+='</ul><select id="items-per-page" class="per-page-selection">',d+=h(5,11),d+="</select>",b.className="pagination-container",b.innerHTML=d,c&&c.remove(),i(b),k(b),j()}function m(){var a=document.createElement("div");a.className="cart",a.innerHTML='<input type="number" disabled="disabled" id="cart-input" />',k(a)}function n(){P=parseInt(this.value,10),l(I),p(1)}function o(){var a=document.createElement("div"),b=document.getElementById("cart-summery"),c=ProductList.Cart.getItemsSummary(),d="",e=null;_.forIn(c,function(a,b){a>0&&(e=ProductList.Utils.getItemById(I,b),d+="<li>"+a+" - "+e.getName()+"</li>")}),d="<ul>"+d+"</ul>",b&&b.remove(),a.innerHTML=d,a.className="items-summery",a.id="cart-summery",k(a)}function p(a){q(L),d(L,I.slice(a*P-P,a*P)),Q=a}function q(a){a.innerHTML=""}function r(a){var b,c=parseInt(a.selectedOptions[0].value,10),d=L.removeChild(a.parentElement.parentElement);b=document.querySelector(".tbody .table-row:nth-child("+c+")"),b?L.insertBefore(d,b):L.appendChild(d),s()}function s(){var a=document.getElementById("products").children;_(a).forEach(function(a,b){a.querySelector(".select-order select").selectedIndex=b}).value()}function t(){var a=document.querySelectorAll(".item-image");_(a).forEach(function(a){a.innerHTML='<img src="'+a.innerHTML+'" />'}).value()}function u(){var a=document.querySelectorAll(".item-description");_(a).forEach(function(a){a.innerHTML="<div>"+a.innerHTML+"</div>"}).value()}function v(){var a=document.querySelectorAll("[data-itemid]"),b="",c=0;_(a).forEach(function(a){b=a.dataset.itemid,c=parseInt(ProductList.Cart.getItemCount(b),10),a.value=c}).value()}function w(a,b,c){var d=parseInt(b.value,10),e=a>0&&d===c.getStock(),f=0>a&&0===d;return f||e}function x(a){return a.className.match("change-amount")}function y(){J.addEventListener("click",function(a){var b=a.target,c=null,d=null,e=null;if(x(b)){if(c=b.parentElement.querySelector("[data-itemid]"),d=ProductList.Utils.getItemById(I,c.dataset.itemid),e=parseInt(b.dataset.action,10),c.value=c.value||0,w(e,c,d))return;ProductList.Cart.updateItem(d.getId(),e)}})}function z(a){var b=document.querySelector('[data-itemid="'+a+'"]');b.value=ProductList.Cart.getItemCount(a)}function A(){M.addEventListener("click",function(a){var b=a.target,c=b.dataset.header;c&&(ProductList.Utils.sortItemObjectsByProperty(I,c),ProductList.PubSub.publish("itemsSorted",[]))})}function B(){q(L),d(L,I),p(Q)}function C(){var a={itemsSorted:[B],couponApplied:[G],orderCommitted:[G,o],itemUpdated:[o,z]};_.forIn(a,function(a,b){_(a).forEach(function(a){ProductList.PubSub.subscribe(b,a)}).value()})}function D(){y(),A(),F(),E()}function E(){var a=document.getElementById("order-form");a.addEventListener("submit",function(a){a.preventDefault(),ProductList.Cart.commitOrder()})}function F(){var a=document.getElementById("coupon-form"),b=document.getElementById("coupon-code"),c=ProductList.Store.getCoupons();a.addEventListener("submit",function(a){var d=b.value,e=_.reduce(c,function(a,b){return b.validate(d).apply()||a},!1);a.preventDefault(),e||alert("Wrong coupon code!"),b.value=""})}function G(){I=ProductList.Store.getProducts(),p(Q)}function H(){C(),D(),p(1),l(I),m(),ProductList.Themes.createThemeChanger()}var I=ProductList.Store.getProducts(),J=document.getElementById("main-table"),K=J.querySelectorAll("[data-header]"),L=document.getElementById("products"),M=document.getElementById("table-header"),N=a(),O=new CustomEvent("moveToPageEvent"),P=5,Q=1;return H(),{handleChange:r,refresh:G,moveToPage:p}}();