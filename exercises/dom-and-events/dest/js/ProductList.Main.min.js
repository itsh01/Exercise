var ProductList=ProductList||{};ProductList.Main=function(){"use strict";function a(){var a,b=K.length,c=[];for(a=0;b>a;a++)c[a]=K[a].dataset.header;return c}function b(){s(),t(),u(),v()}function c(a,b){var c=0,d=a.length>P?P:a.length,f=document.createDocumentFragment();for(c;d>c;c++)f.appendChild(e(a[c],b,d));return f}function d(a,d,e){var f=null;f=c(d,e),a.appendChild(f),b()}function e(a,b,c){var d=document.createElement("div"),e=null,h=b.length,i=0,j=a instanceof ProductList.Store.ItemOnSale,k=!a.isInStock(),l=null;for(d.className+=" table-row",j&&(d.className+=" item-on-sale"),k&&(d.className+=" item-out-of-stock"),i;h>i;i++)l=b[i],e=document.createElement("div"),e.innerHTML=a.data[l],j&&"price"===l&&(e.innerHTML='<div class="discounted">'+a.data[l]+"<div>",e.innerHTML+='<div class="real-price">'+a.getPrice()+"&dollar;<div>"),e.className="table-cell item-"+l,d.appendChild(e);return d.appendChild(f(a.getId())),g(d,c),d}function f(a){var b=document.createElement("div");return b.className="table-cell",b.innerHTML='<input type="number" disabled="disabled" data-itemid="'+a+'" />',b.innerHTML+='<button class="btn btn-primary btn-xs change-amount" data-action="-1">-</button>',b.innerHTML+='<button class="btn btn-primary btn-xs change-amount" data-action="1">+</button>',b}function g(a,b){var c=a.querySelector(".item-id"),d=document.createElement("div"),e=document.createElement("select");e.innerHTML=h(1,b+1),e.addEventListener("change",function(){r(this)}),d.className="table-cell select-order",d.appendChild(e),a.insertBefore(d,c)}function h(a,b){var c="",d=a;for(d;b>d;d++)c+='<option value="'+d+'">'+d+"</option>";return c}function i(a){var b=0,c=0,d=ProductList.Utils.convertToArray(a.querySelectorAll("[data-pagenum]")),e=d.length;for(b;e>b;b++)c=d[b].dataset.pagenum,d[b].addEventListener("moveToPageEvent",p.bind(null,c)),d[b].addEventListener("click",function(){this.dispatchEvent(O)})}function j(){var a=document.getElementById("items-per-page");a.addEventListener("change",n),a.value=P}function k(a){document.getElementsByClassName("container")[0].appendChild(a)}function l(a){var b,c=document.createElement("nav"),d='<ul class="pagination">',e=Math.ceil(a.length/P),f=0,g=0;for(c.className="pagination-container",f;e>f;f++)g=f+1,d+='<li><a href="#" data-pagenum="'+g+'">'+g+"</a></li>";d+='</ul><select id="items-per-page" class="per-page-selection">',d+=h(5,11),d+="</select>",c.innerHTML=d,i(c),b=document.querySelector(".pagination-container"),b&&b.remove(),k(c),j()}function m(){var a=document.createElement("div");a.className="cart",a.innerHTML='<input type="number" disabled="disabled" id="cart-input" />',k(a)}function n(){P=parseInt(this.value,10),l(I),p(1)}function o(){var a,b,c,d,e=document.createElement("div"),f="";b=ProductList.Cart.getItemsSummary(),f+="<ul>";for(d in b)b.hasOwnProperty(d)&&0!==b[d]&&(c=ProductList.Utils.getItemById(I,d),f+="<li>"+b[d]+" - "+c.getName()+"</li>");f+="</ul>",a=document.getElementById("cart-summery"),a&&a.remove(),e.innerHTML=f,e.setAttribute("id","cart-summery"),e.className="items-summery",k(e)}function p(a){q(L),d(L,I.slice(a*P-P,a*P),N),Q=a}function q(a){a.innerHTML=""}function r(a){var b,c=parseInt(a.selectedOptions[0].value,10),d=document.getElementById("products"),e=d.removeChild(a.parentElement.parentElement);b=document.querySelector(".tbody .table-row:nth-child("+c+")"),b?d.insertBefore(e,b):d.appendChild(e),s()}function s(){var a,b=document.getElementById("products").children,c=b.length;for(a=0;c>a;a++)b[a].querySelector(".select-order select").selectedIndex=a}function t(){var a=document.querySelectorAll(".item-image"),b=a.length-1;for(b;b>=0;b--)a[b].innerHTML='<img src="'+a[b].innerHTML+'" />'}function u(){var a=document.querySelectorAll(".item-description"),b=a.length-1;for(b;b>=0;b--)a[b].innerHTML="<div>"+a[b].innerHTML+"</div>"}function v(){var a=document.querySelectorAll("[data-itemid]"),b=a.length-1,c="",d=0;for(b;b>=0;b--)c=a[b].dataset.itemid,d=parseInt(ProductList.Cart.getItemCount(c),10),a[b].value=d}function w(a,b,c){var d=parseInt(b.value,10),e=a>0&&d===c.getStock(),f=0>a&&0===d;return f||e}function x(a){return a.className.match("change-amount")}function y(){J.addEventListener("click",function(a){var b=a.target,c=null,d=null,e=null;if(x(b)){if(c=b.parentElement.querySelector("[data-itemid]"),d=ProductList.Utils.getItemById(I,c.dataset.itemid),e=parseInt(b.dataset.action,10),c.value=c.value||0,w(e,c,d))return;ProductList.Cart.updateItem(d.getId(),e)}})}function z(a){var b=document.querySelector('[data-itemid="'+a+'"]');b.value=ProductList.Cart.getItemCount(a)}function A(){M.addEventListener("click",function(a){var b=a.target,c=b.dataset.header;c&&(ProductList.Utils.sortItemObjectsByProperty(I,c),ProductList.PubSub.publish("itemsSorted",[]))})}function B(){q(L),d(L,I,N),p(Q)}function C(){var a=null,b=0,c=[],d={itemsSorted:[B],couponApplied:[G],orderCommitted:[G,o],itemUpdated:[o,z]};for(a in d)if(d.hasOwnProperty(a))for(c=d[a],b=0;b<c.length;b++)ProductList.PubSub.subscribe(a,c[b])}function D(){y(),A(),F(),E()}function E(){var a=document.getElementById("order-form");a.addEventListener("submit",function(a){a.preventDefault(),ProductList.Cart.commitOrder()})}function F(){var a=document.getElementById("coupon-form"),b=document.getElementById("coupon-code"),c=ProductList.Store.getCoupons(),d="",e=c.length;a.addEventListener("submit",function(a){var f=0,g=!1;for(a.preventDefault(),d=b.value,f;e>f;f++)g=c[f].validate(d).apply()||g;g||alert("Wrong coupon code!"),b.value=""})}function G(){I=ProductList.Store.getProducts(),p(Q)}function H(){C(),D(),p(1),l(I),m(),ProductList.Themes.createThemeChanger()}var I=ProductList.Store.getProducts(),J=document.getElementById("main-table"),K=J.querySelectorAll("[data-header]"),L=document.getElementById("products"),M=document.getElementById("table-header"),N=a(),O=new CustomEvent("moveToPageEvent"),P=5,Q=1;return H(),{handleChange:r,refresh:G,moveToPage:p}}();